{
  "name": "RetailFlow_Main_Pipeline",
  "description": "RAW → Bronze → Silver → Gold for retail data platform",
  "schedule": {
    "quartz_cron_expression": "0 0 2 * * ?",
    "timezone_id": "UTC",
    "pause_status": "UNPAUSED"
  },
  "email_notifications": {
    "on_failure": ["data-engineering@retail.example.com"],
    "on_success": [],
    "no_alert_for_skipped_runs": false
  },
  "timeout_seconds": 0,
  "max_concurrent_runs": 1,
  "tasks": [
    {
      "task_key": "ingest_raw_orders",
      "notebook_task": {
        "notebook_path": "/Workspace/Repos/retailflow/databricks/notebooks/raw/01_ingest_orders_api",
        "source": "WORKSPACE"
      },
      "job_cluster_key": "job_cluster",
      "timeout_seconds": 1800
    },
    {
      "task_key": "ingest_raw_customers",
      "notebook_task": {
        "notebook_path": "/Workspace/Repos/retailflow/databricks/notebooks/raw/02_ingest_customers_api",
        "source": "WORKSPACE"
      },
      "job_cluster_key": "job_cluster",
      "timeout_seconds": 1800
    },
    {
      "task_key": "bronze_orders",
      "depends_on": [{"task_key": "ingest_raw_orders"}],
      "notebook_task": {
        "notebook_path": "/Workspace/Repos/retailflow/databricks/notebooks/bronze/01_bronze_orders",
        "source": "WORKSPACE"
      },
      "job_cluster_key": "job_cluster",
      "timeout_seconds": 3600
    },
    {
      "task_key": "bronze_customers",
      "depends_on": [{"task_key": "ingest_raw_customers"}],
      "notebook_task": {
        "notebook_path": "/Workspace/Repos/retailflow/databricks/notebooks/bronze/02_bronze_customers",
        "source": "WORKSPACE"
      },
      "job_cluster_key": "job_cluster",
      "timeout_seconds": 3600
    },
    {
      "task_key": "silver_orders",
      "depends_on": [{"task_key": "bronze_orders"}],
      "notebook_task": {
        "notebook_path": "/Workspace/Repos/retailflow/databricks/notebooks/silver/01_silver_orders",
        "source": "WORKSPACE"
      },
      "job_cluster_key": "job_cluster",
      "timeout_seconds": 3600
    },
    {
      "task_key": "silver_customers",
      "depends_on": [{"task_key": "bronze_customers"}],
      "notebook_task": {
        "notebook_path": "/Workspace/Repos/retailflow/databricks/notebooks/silver/02_silver_customers",
        "source": "WORKSPACE"
      },
      "job_cluster_key": "job_cluster",
      "timeout_seconds": 3600
    },
    {
      "task_key": "gold_fact_orders",
      "depends_on": [{"task_key": "silver_orders"}, {"task_key": "silver_customers"}],
      "notebook_task": {
        "notebook_path": "/Workspace/Repos/retailflow/databricks/notebooks/gold/01_gold_fact_orders",
        "source": "WORKSPACE"
      },
      "job_cluster_key": "job_cluster",
      "timeout_seconds": 3600
    },
    {
      "task_key": "gold_dim_customer",
      "depends_on": [{"task_key": "silver_customers"}],
      "notebook_task": {
        "notebook_path": "/Workspace/Repos/retailflow/databricks/notebooks/gold/03_gold_dim_customer_scd2",
        "source": "WORKSPACE"
      },
      "job_cluster_key": "job_cluster",
      "timeout_seconds": 3600
    },
    {
      "task_key": "gold_daily_revenue",
      "depends_on": [{"task_key": "gold_fact_orders"}],
      "notebook_task": {
        "notebook_path": "/Workspace/Repos/retailflow/databricks/notebooks/gold/05_gold_daily_revenue_mart",
        "source": "WORKSPACE"
      },
      "job_cluster_key": "job_cluster",
      "timeout_seconds": 1800
    }
  ],
  "job_clusters": [
    {
      "job_cluster_key": "job_cluster",
      "new_cluster": {
        "spark_version": "14.3.x-scala2.12",
        "node_type_id": "Standard_DS3_v2",
        "num_workers": 2,
        "spark_conf": {
          "spark.sql.adaptive.enabled": "true",
          "spark.databricks.delta.optimizeWrite.enabled": "true",
          "spark.databricks.delta.autoCompact.enabled": "true"
        },
        "azure_attributes": {
          "availability": "ON_DEMAND_AZURE"
        }
      }
    }
  ],
  "tags": {
    "project": "RetailFlow",
    "layer": "platform"
  }
}
